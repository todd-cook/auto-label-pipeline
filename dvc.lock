schema: '2.0'
stages:
  fetch:
    cmd:
    - python src/fetch.py --param_group fetch_data
    - python src/fetch.py --param_group fetch_model
    deps:
    - path: src/fetch.py
      md5: 67f9be1163f631e658edd0723f4b73fc
      size: 2729
    params:
      params.yaml:
        fetch_data.file: crawl-300d-2M-subword.bin
        fetch_data.uri: https://dl.fbaipublicfiles.com/fasttext/vectors-english/crawl-300d-2M-subword.zip
        fetch_model.file: lid.176.ftz
        fetch_model.uri: https://dl.fbaipublicfiles.com/fasttext/supervised-models/lid.176.ftz
  fetch_data:
    cmd: python src/fetch.py --param_group fetch_data
    deps:
    - path: src/fetch.py
      md5: 7049a5c91d31d873d9f4285e4c4fafea
      size: 2086
    params:
      params.yaml:
        fetch_data.file: crawl-300d-2M-subword.bin
        fetch_data.uri: https://dl.fbaipublicfiles.com/fasttext/vectors-english/crawl-300d-2M-subword.zip
  fetch_model:
    cmd: python src/fetch.py --param_group fetch_model
    deps:
    - path: src/fetch.py
      md5: 7049a5c91d31d873d9f4285e4c4fafea
      size: 2086
    params:
      params.yaml:
        fetch_model.file: lid.176.ftz
        fetch_model.uri: https://dl.fbaipublicfiles.com/fasttext/supervised-models/lid.176.ftz
  prepare:
    cmd: python src/prepare.py
    deps:
    - path: data/raw
      md5: 1dd542a6703dd78c388be16a4c238afe.dir
      size: 18999626217
      nfiles: 8
    - path: src/prepare.py
      md5: f1a9a0d27ff6a76f3f9e8ab19c7ce476
      size: 9607
    params:
      params.yaml:
        fetch_data.file: crawl-300d-2M-subword.bin
        prepare.embeddings_dim: 300
        prepare.filter_count_gteq: 2
        prepare.filter_lang: en
        prepare.filter_lang_bool: true
        prepare.lang_detect_model: lid.176.ftz
        prepare.stopwords_filter_lang: english
        prepare.tfidf_dict_pickle_file: ''
    outs:
    - path: data/prepared/data.all.csv
      md5: 0346c908967902a9b8b3f04a66b125e8
      size: 154638900
    - path: reports/prepare.metrics.json
      md5: d1e59667ae567c5ee394f615be7a3536
      size: 68
  train:
    cmd: python src/train.py
    deps:
    - path: data/prepared/data.all.csv
      md5: 0346c908967902a9b8b3f04a66b125e8
      size: 154638900
    - path: src/train.py
      md5: 2408c0a20a531898b1853c03aa856b1b
      size: 5632
    params:
      params.yaml:
        train.class_types:
        - employer
        - occupation
        - UNK
        train.degree: 3
        train.dual: true
        train.gamma: scale
        train.kernel: rbf
        train.loss: squared_hinge
        train.model_type: LinearSVC
        train.num_components: 9
        train.penalty: l2
        train.regularization_C: 0.1
        train.seed: 31
        train.split: 0.8
        train.use_pca: true
    outs:
    - path: model/class.metrics.csv
      md5: a65dfd3ef0b5dbca1bbc20578e1a553a
      size: 122443
    - path: model/svm.model.pkl
      md5: ac6d9b9b0c10ea64ef03059776fc8da2
      size: 892
    - path: model/train.metrics.json
      md5: 5b84efb59b655011046f3f5e2e61d854
      size: 345
  relabel:
    cmd: python src/relabel.py
    deps:
    - path: data/prepared/data.all.csv
      md5: 0346c908967902a9b8b3f04a66b125e8
      size: 154638900
    - path: model/svm.model.pkl
      md5: ac6d9b9b0c10ea64ef03059776fc8da2
      size: 892
    - path: src/relabel.py
      md5: 9c80ef2d78955890e04f12fdb31b94d4
      size: 8850
    params:
      params.yaml:
        relabel.frac_noise: 1.0
        train.class_types:
        - employer
        - occupation
        - UNK
        train.degree: 3
        train.dual: true
        train.gamma: scale
        train.kernel: rbf
        train.loss: squared_hinge
        train.model_type: LinearSVC
        train.penalty: l2
        train.regularization_C: 0.1
        train.seed: 31
    outs:
    - path: data/final/class.metrics.csv
      md5: 0dfb7f9672b5f221a86af1adbf5047a2
      size: 121100
    - path: data/final/data.csv
      md5: 579a953596409304b1b0014ab437d2c7
      size: 154842405
    - path: reports/relabel.metrics.json
      md5: 6a8544d5197536273e8fb64d7a34cd3d
      size: 113
