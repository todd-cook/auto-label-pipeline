schema: '2.0'
stages:
  fetch:
    cmd:
    - python src/fetch.py --param_group fetch_data
    - python src/fetch.py --param_group fetch_model
    deps:
    - path: src/fetch.py
      md5: 01be87b0afe150dd41b37cbda5271f71
      size: 2763
    params:
      params.yaml:
        fetch_data.file: crawl-300d-2M-subword.bin
        fetch_data.uri: https://dl.fbaipublicfiles.com/fasttext/vectors-english/crawl-300d-2M-subword.zip
        fetch_model.file: lid.176.ftz
        fetch_model.uri: https://dl.fbaipublicfiles.com/fasttext/supervised-models/lid.176.ftz
  prepare:
    cmd: python src/prepare.py
    deps:
    - path: data/raw
      md5: 573f9cdf42c2928857daa1fc1b4520db.dir
      size: 11762456053
      nfiles: 8
    - path: src/prepare.py
      md5: 7e8282bdb051a4fb1318eba3d3dd19d0
      size: 9655
    params:
      params.yaml:
        fetch_data.file: crawl-300d-2M-subword.bin
        prepare.embeddings_dim: 300
        prepare.filter_count_gteq: 2
        prepare.filter_lang: en
        prepare.filter_lang_bool: true
        prepare.lang_detect_model: lid.176.ftz
        prepare.stopwords_filter_lang: english
        prepare.tfidf_dict_pickle_file: ''
    outs:
    - path: data/prepared/data.all.csv
      md5: 0346c908967902a9b8b3f04a66b125e8
      size: 154638900
    - path: reports/prepare.metrics.json
      md5: d1e59667ae567c5ee394f615be7a3536
      size: 68
  train:
    cmd: python src/train.py
    deps:
    - path: data/prepared/data.all.csv
      md5: 0346c908967902a9b8b3f04a66b125e8
      size: 154638900
    - path: src/train.py
      md5: 787f27ed252fbaec9e14532f69146723
      size: 6843
    params:
      params.yaml:
        train.class_types:
        - employer
        - occupation
        - UNK
        train.knc_algorithm: auto
        train.knc_leaf_size: 30
        train.knc_metric: minkowski
        train.knc_n_neighbors: 5
        train.knc_p: 2
        train.knc_weights: uniform
        train.model_type: KNeighborsClassifier
        train.num_components: 9
        train.seed: 31
        train.split: 0.7
        train.svm_degree: 3
        train.svm_dual: true
        train.svm_gamma: scale
        train.svm_kernel: rbf
        train.svm_loss: squared_hinge
        train.svm_penalty: l2
        train.svm_regularization_C: 1
        train.use_pca: false
    outs:
    - path: model/class.metrics.csv
      md5: 3fb716094aa57be6ff7e7051fd5afa82
      size: 182830
    - path: model/svm.model.pkl
      md5: 6e7460ddf3f7e4d462e6f8c97cb8eee8
      size: 55798871
    - path: model/train.metrics.json
      md5: 101d4b615ee521554704290e36162158
      size: 407
  relabel:
    cmd: python src/relabel.py
    deps:
    - path: data/prepared/data.all.csv
      md5: 0346c908967902a9b8b3f04a66b125e8
      size: 154638900
    - path: model/svm.model.pkl
      md5: 6e7460ddf3f7e4d462e6f8c97cb8eee8
      size: 55798871
    - path: src/relabel.py
      md5: 6eeac5b67989a9f15e8c48e991010c79
      size: 8573
    params:
      params.yaml:
        prepare.unknown_tag: UNK
        relabel.max_distance_decision: 2.2929098075032224
        relabel.min_distance_decision: -0.29124524614142283
        relabel.num_crossval_folds: 10
        train.class_types:
        - employer
        - occupation
        - UNK
        train.knc_algorithm: auto
        train.knc_leaf_size: 30
        train.knc_metric: minkowski
        train.knc_n_neighbors: 5
        train.knc_p: 2
        train.knc_weights: uniform
        train.model_type: KNeighborsClassifier
        train.seed: 31
        train.split: 0.7
        train.svm_degree: 3
        train.svm_dual: true
        train.svm_gamma: scale
        train.svm_kernel: rbf
        train.svm_loss: squared_hinge
        train.svm_penalty: l2
        train.svm_regularization_C: 1
    outs:
    - path: data/final/class.metrics.csv
      md5: 7e501b2ae093532f7ec501b1cccbb0f2
      size: 178208
    - path: data/final/data.csv
      md5: 91f686e63f8ff42b37b1f33b8eabfd8e
      size: 2864690
    - path: reports/relabel.metrics.json
      md5: 578a346115f7281c21e2566f2342252f
      size: 113
